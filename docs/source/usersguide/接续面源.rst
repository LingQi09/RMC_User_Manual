.. _section_conti_surf:

接续面源
====================

RMC支持接续面源计算文件输出功能。接续面源计算，用于将粒子径迹记录在面上，
供屏蔽计算使用。额外信息由模块BinaryOut定义。

接续面源文件输出模块输入卡
---------------------------------------------

.. code-block:: none

    Binaryout
    WrtSurfSrc  Write=<flag>  SYMM=<symm>  PARTYPE = <parms>
                Surf = <Surface_vector_group>  CeL=<cell_vector_group>
                WCylces=<wcycles> Wssa=<flag>

其中，

-   **Write**\ 指定是否输出接续计算文件，1表示输出，0表示不输出，默认值为0。

-   **Cel**\ 仅适用于临界计算。记录临界计算中，在指定栅元中产生的源粒子。

-   **Symm**\ 指定粒子径迹记录的方式。0代表对称记录，即Surf中定义的面仅能为球面，
    且只能定义1个，这种情况很少见，用户需要确定是否可以使用。1代表记录方式按Surf中介绍记录。
    2代表记录穿过Surf中定义面的径迹，无论径迹方向如何。默认值是1。

-   **Partype**\ 指定记录的径迹类型，0代表中子，1代表光子。默认包含计算中所使用的所有种类径迹。

-   **Surf**\ 是指定需要被记录的面，将在下面详细介绍。
    其输入格式具体为Ids1(Idc1 Idc2 Idc3) Ids2，如：Surf=-1(2 -3)  3。
    其中Ids代表的是需要记录面的序号，可正可负。正负号代表粒子径迹穿过面的方向与面的法向夹角余弦值为正或为负。
    括号内代表栅元序号，可正可负。“+”(可缺省)代表进入该栅元，“-”代表离开该栅元。
    例如Surf=-1(2 -3)  3，表示记录穿过面1，且与1面正法线方向夹角为负数，进入栅元2或者离开栅元3的径迹，
    或者沿与面3正法线方向夹角为正的径迹。如果Symm为2，则记录穿过面1且进入栅元2或者离开栅元3，或者穿过面3的径迹。

-   **Wcycles**\ 是指接续计算中需要记录的活跃代数，如果不定义则默认记录全部活跃代数。

-   **MCNP5_Wssa**\=1是指将RMC输出的接续面源文件转换为MCNP5-1.20和MCNP5-1.51格式的面源文件，**MCNP5_Wssa**\ 默认值为0，
    并且0的时候不进行转换。**MCNP6_Wssa**\=1是指将RMC输出的接续面源文件转换为MCNP6.1.1格式的面源文件，**MCNP6_Wssa**\ 默认值为0，
    并且0的时候不进行转换。该功能需要使用RMC的python框架进行计算，新建一个test文件夹，同时将RMC的python框架中的runner.py复制过来，
    同时新建一个文件夹 workspace,将输入卡、RMC的可执行文件、xsdir,然后调用文件夹外的runner.py,运行命令为python3 runner.py
    workspace/inp --mpi mpi核数。输出的MCNP格式的面源文件在archive文件夹中,会分别根据判断输出MCNP5与MCNP6格式的面源文件，
    输出的MCNP6格式的面源文件名称为rssa_mcnp6.1.1，输出的MCNP5格式的面源文件有两个，分别为rssa_mcnp5-1.20和rssa_mcnp5-1.51。

接续面源文件使用
-----------------------

要使用接续面源，首先需要输出接续面源文件，接续面源文件输出使用方法见3.1.21.1接续面源文件输出。
接续面源文件输出为WSurfSrc文件。要计算，则将WSurfSrc重命名为SurfSrc文件。此外，按照3.1.16.3中描述进行计算则可以。

在计算当中，除了输出RMC规定的文件之外，还将会输出SurfSrcOutput.out文件，其中将记录接续面源文件的相近信息。


接续面源模块示例
-----------------------   

.. code-block:: c

    BinaryOut
    SurfSrcWrt    surf = 1(-2 3) cel =2 symm=0 Partype = 0 1

