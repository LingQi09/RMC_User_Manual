.. _section_variance_reduction:

减方差
====================

RMC支持减方差计算功能，包括区域重要性，源偏倚和权窗技术。
目前区域重要性和权窗技术都只在固定源模式下使用。
权窗技术包括栅元权窗和网格权窗，对于同一种粒子类型（中子、光子、电子），
区域重要性、栅元权窗和网格权窗三种减方差方法只能同时使用其中的一种。

区域重要性输入卡
----------------------

在栅元信息卡中增加几何重要性\ **imp**\ 选项卡，其分为中子几何重要性\ **imp:n**\ 、
光子几何重要性\ **imp:p**\ 和电子几何重要性\ **imp:e**\ 。例如：imp:n=0，
imp:n=1，imp:n=2，imp:p=0，imp:p=1，imp:p=2，imp:e=0，imp:e=1，imp:e=2，等等。

权窗输入卡
----------------------

.. code-block:: none

    WeightWindow
    WWN:N  W_1  W_2  W_3  W_4 … W_n 
    WWMESH:N  W_1  W_2  W_3  W_4 … W_n
    WWP:N  WUPN WSUV 

示例为中子的栅元权窗和网格权窗输入卡。其中，

-  **WeightWindow**\ 为减方差的权窗输入卡的关键词；

-  **WWN:N**\ 为中子的栅元权窗卡，W1、W2、W3等等分别表示每个栅元
   的权窗下限。若是光子的栅元权窗卡，则把关键词替换为WWN:P。
   若是电子的栅元权窗卡，则把关键词替换为WWN:E；

-  **WWMESH:N**\ 为中子的网格权窗卡，W1、W2、W3等等分别表示每个网格的权窗下限。
   网格的几个定义在网格计数器部分，目前的程序支持非均匀网格和
   非均匀圆柱网格。若是光子的网格权窗卡，则把关键词替换为\ **WWMESH:P**\ 。
   若是电子的网格权窗卡，则把关键词替换为\ **WWMESH:E**\ 。；

-  **WWP:N**\ 为中子的权窗参数卡，\ **WUPN**\ 表示权窗上限与下限的倍数，
   要求WUPN>2，默认值为5。\ **WSUV**\ 表示存活粒子权重与权窗下限的倍数，
   要求1<WSURVN<WUPN，默认值为3。若是光子的权窗参数卡，则把关键词替换
   为\ **WWP:P**\ 。若是电子的权窗参数卡，则把关键词替换为\ **WWP:E**\ ；

-  注意，同一种粒子权窗卡只能同时使用一种。比如对于中子，\ **WWN:N**\ 和
   \ **WWMESH:N**\ 只定义其中的一个就可以。若\ **WWP:N**\ 没有定义，则为默认值。


-  **MCNPWeightWindow**\ 为兼容MCNP权窗输入卡参数的关键词；

.. code-block:: none

    MCNPWeightWindow
    WWE:N  E_1  E_2  E_3  E_4 … E_n
    WWN1:N W_11  W_12  W_13  W_14 … W_1n
    WWN2:N W_21  W_22  W_23  W_24 … W_2n
    WWG:N  It  Ic  Wg  J1  J2
    WWINP  FileName

-  **WWE:N**\ 为中子的栅元权窗卡，W1、W2、W3等等分别表示每个栅元
   的能量间隔，在WWN卡上将指定重量窗口的界限。最小能量不在WWE卡上输入，但被定义为零。

-  **WWNi:N**\ 规定了栅元中与空间和能量相关的权窗的下限。如果权窗是能量相关的，则必须与WWE卡一起使用。粒子的权重界限总是绝对的，而不是相对的，用户必须为每个能量的每个栅元指定一个权窗下限，也就是说，如果指定了WWNi，还必须指定1<k<i的WWNk。


WWN卡示例

.. code-block:: none

    WWE:N     e1  e2  e3
    WWN1:N    w11  w12  w13  w14
    WWN2:N    w21  w22  w23  w24
    WWN3:N    w31  w32  w33  w34

该示例定义了3个能量区间下的4个栅元的中子权窗下限。即0-e1能量分箱下cell1至cell4的权窗下限分别为w11、w12、w13、w14；以此类推。


-  **WWG:N**\ 为权窗下限自动生成器参数卡，It表示参考的CellTally或者MeshTally的计数器编号。Ic表示基于cell或基于mesh的权重窗生成器，如果Ic>0，则调用基于cell的权窗生成器；如果Ic=0，则调用基于mesh的权窗生成器。Wg为参考的CellTally或参考MeshTally生成的权窗下限值，如果Wg=0，那么参考的CellTally或参考MeshTally的权窗下限为0.5，Wg默认值为0。J1表示是否计算固定源模式下针对探测器的中子伴随通量分布；J1默认值为0，J1=0表示不开启该功能；J1=1表示开启该功能，使用J1=1时必须指定中子伴随通量计算区域和探测器所在区域，即必须分别至少设置一个MeshTally type=9和一个MeshTally type=10。J2表示MeshTally的中的参考小网格的编号，J2必须与Ic=0配合使用。

-  **WWINP**\ 为RMC读取MCNP的权窗文件格式功能卡，FileName为MCNP权窗格式文件名。


